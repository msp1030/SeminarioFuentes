---
title: "Relación entre Alzheimer y Calidad del Aire y Zonas Verdes"
author: "Manuel Sánchez Paredes y Santiago Herrero Ruipérez"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introducción

En este seminario se va a estudiar la relación entre la calidad del aire y las zonas verdes en poblaciones y el Alzheimer.

Los datos respecto al Alzheimer y a las zonas verdes se han obtenido del Instututo Nacional de Estadística (INE), mientras que los datos de la calidad del aire se han obtenido mediante el paquete `airqES` del proyecto `ROpenSpain`.

## Carga de Librerías empleadas

```{r, message=FALSE, warning=FALSE}
library(airqualityES)
library(pxR)
library(tidyverse)
```

## Carga de Datos

### Carga de Zonas Verdes

Los datos de las zonas verdes se encuentran en formato PC-AXIS, por lo que se emplea el paquete `pxR` para leer los datos.

```{r}
zonas_verdes <- read.px("data/zonas_verdes.px")$DATA
zonas_verdes_df <- zonas_verdes$value
zonas_verdes_df<-zonas_verdes_df[-c(1,2,3,4,5), ]#eliminamos las filas 1, 2, 3, 4 y 5
zonas_verdes_df
```

### Carga de Alzheimer

Los datos de Alzheimer, al igual que los datos de zonas verdes se encuentran en formato PC-AXIS, por lo que se emplea el paquete `pxR` para leer los datos.

```{r}
alzheimer <- read.px("data/alzheimer_total.px")$DATA
alzheimer_df<-alzheimer$value
alzheimer_df<-alzheimer_df[,-c(1,2)]#eliminamos las columnas 1 y 2 
alzheimer_df
```

### Carga de Calidad del Aire

La tabla con los datos de la Calidad del Aire se encuentra cargada por el paquete `airqES`.

```{r}
data("airqES")
```

## Modificación y Creación de las Tablas

### Modificación de Zonas Verdes
```{r}

```

### Modificación de Alzheimer
```{r}

```

### Modificación de Calidad del Aire
La primera modificación de los datos es filtrar por el año de interés, en este caso 2018, y hacer la media de los dias de cada mes para cada estación.

```{r}
calidad_aire <- airqES %>%
  filter(year == 2018) %>%
  mutate(media_mensual = apply(.[, c(8:38)], 1, mean, na.rm = TRUE))%>%
  select(month, province, station_id, pollutant, media_mensual)
```

Luego, se establecen los meses y provincias por su nombre en lugar de números.

```{r}
meses<-c("Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", 
         "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre")
#remplazamos los meses en la tabla
calidad_aire$month<-meses[calidad_aire$month]
provincia = c("Alava", "Albacete", "Alicante", "Almeria", "Avila",  "Badajoz", "Baleares", "Barcelona", "Burgos", "Caceres", "Cadiz",  "Castellon", "Ciudad Real", "Cordoba", "Coruña", "Cuenca", "Girona", "Granada", "Guadalajara", "Gipuzkoa", "Huelva", "Huesca", "Jaen", "Leon", "Lleida", "Rioja", "Lugo", "Madrid", "Málaga", "Murcia", "Navarra", "Ourense", "Asturias", "Palencia", "Palmas", "Pontevedra", "Salamanca", "Santa_Cruz_de_Tenerife", "Cantabria", "Segovia", "Sevilla", "Soria", "Tarragona", "Teruel", "Toledo", "Valencia", "Valladolid", "Bizkaia", "Zamora", "Zaragoza")
calidad_aire$province<-provincia[calidad_aire$province]

```
A continuación, se pivota para establecer los meses como atributos, y se hace la media de sus valores para obtener la media anual de cada estación.
```{r}
wide_calidad_aire<-
  calidad_aire%>%
  pivot_wider(names_from = "month", values_from = "media_mensual")

wide_calidad_aire<-
  wide_calidad_aire%>%
  mutate(media_anual = apply(.[, c(4:15)], 1, mean, na.rm = TRUE)) %>% select(province:pollutant, media_anual)
```

Se pasan las medidas de los contaminantes a porcentajes del valor límite.

```{r}
wide_calidad_aire <-mutate(.data = wide_calidad_aire,
  porcentaje = case_when(
    !is.na(media_anual) & pollutant == "PM10" ~ (media_anual / 40) * 100,
    !is.na(media_anual) & pollutant == "PM2.5" ~ (media_anual / 25) * 100,
    !is.na(media_anual) & pollutant == "Pb" ~ (media_anual / 0.5) * 100,
    !is.na(media_anual) & pollutant == "As" ~ (media_anual / 6) * 100,
    !is.na(media_anual) & pollutant == "Cd" ~ (media_anual / 5) * 100,
    !is.na(media_anual) & pollutant == "Ni" ~ (media_anual / 20) * 100,
    !is.na(media_anual) & pollutant == "B(a)P" ~ (media_anual / 1) * 100,
    TRUE ~ NA_real_
  )
) %>% select(province:pollutant, porcentaje)
```

```{r}
wide_calidad_aire <- group_by(.data = wide_calidad_aire, province, pollutant) %>% 
  dplyr::summarise(media_porcentaje = mean(porcentaje, na.rm = TRUE)) %>% 
  ungroup()
```

